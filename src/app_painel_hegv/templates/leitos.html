{% extends 'base-leitos.html' %}
{% block content %}
{% load static %}
<div class="container-fluid">
    <div class="card mt-3">
      <div class="card-header">
        Leitos
      </div>
      <div class="card-body">
        <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
          <button type="button" class="btn btn-secondary">Novo</button>
          <button type="button" class="btn btn-secondary">2</button>
        
          <div class="btn-group" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Dropdown
            </button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
              <a class="dropdown-item" href="#">Dropdown link</a>
              <a class="dropdown-item" href="#">Dropdown link</a>
            </div>
          </div>
        </div>
      <div class="table-responsive">
        <table class="table table-hover" id="tabela-leitos">
          <thead class="table">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Paciente</th>
              <th scope="col">Boletim</th>
              <th scope="col">Internação</th>
              <th scope="col">Previsão de Alta</th>
              <th scope="col">Clínica</th>
              <th scope="col">Procedimento</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- As linhas serão preenchidas via JavaScript -->
          </tbody>
        </table>
      </div>
      </div>


    </div>
  </div>

  <script>

document.addEventListener('DOMContentLoaded', function() {

  let sala = "{{ sala_nome|urlencode }}";  // Pega o nome da sala que veio da view

  console.log(sala)

  if (!sala) {
    // Se não tem sala, não busca nada ou busca geral (você decide)
    return;
  }

  fetch(`/get_all_leitos/${sala}/`)  // ajuste para o seu endpoint
    .then(response => response.json())
    .then(data => {
      const tbody = document.querySelector('#tabela-leitos tbody');
      const leitos = data.leitos;

      // Ordenar os leitos pelo campo 'numero'
      leitos.sort((a, b) => a.numero - b.numero);

      leitos.forEach(leito => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <th scope="row">${leito.numero.toString().padStart(2, '0')}</th>
          <td>${leito.paciente || 'Sem Paciente'}</td>
          <td>${leito.boletim || '-'}</td>
          <td>${formatarData(leito.internacao)}</td>
          <td>${formatarData(leito.alta)}</td>
          <td>${leito.sala || '-'}</td>
          <td>${leito.procedimento || '-'}</td>
          <td>
            <td>
              <a href="/leito/${leito.id}/editar/" class="btn btn-sm btn-primary">Editar</a>
            </td>
          </td>
        `;

        tbody.appendChild(tr);
      });
    })
    .catch(error => console.error('Erro ao buscar leitos:', error));
});

// Mesma função pra formatar datas
function formatarData(data) {
  if (!data) return '-';
  const d = new Date(data);
  return d.toLocaleDateString('pt-BR');
}

// Função chamada ao clicar no botão editar
function editarLeito(id) {
  alert(`Editar leito ID: ${id}`);
  // Aqui você pode redirecionar para uma página de edição
  // Exemplo: window.location.href = `/leitos/editar/${id}/`
}


  </script>

{% endblock %}